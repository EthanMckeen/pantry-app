"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ModuleAlias = void 0;
const trace_attributes_1 = require("@langtrase/trace-attributes");
const path_1 = require("path");
class ModuleAlias {
    constructor(cwd) {
        this.supportedModuleAliases = ['ai'];
        this.cwd = cwd;
    }
    apply(resolver) {
        resolver.getHook('before-resolve').tapAsync(this.constructor.name, (request, _context, callback) => {
            if (this.supportedModuleAliases.includes(request.request)) {
                const modulePath = request.path;
                if (typeof modulePath === 'string' && modulePath?.includes('node_modules/@langtrase/typescript-sdk')) {
                    // Use the original module if imported from the SDK. Cwd comes from the project using the SDK
                    if (request.request === trace_attributes_1.Vendors.VERCEL) {
                        request.request = (0, path_1.resolve)(this.cwd, `node_modules/${trace_attributes_1.Vendors.VERCEL}`);
                    }
                }
                else {
                    // Use the alias module for all other imports of the module
                    if (request.request === trace_attributes_1.Vendors.VERCEL) {
                        request.request = (0, path_1.resolve)(this.cwd, `node_modules/@langtrase/typescript-sdk/dist/module-wrappers/${trace_attributes_1.Vendors.VERCEL}.js`);
                    }
                }
            }
            callback();
        });
    }
}
exports.ModuleAlias = ModuleAlias;
//# sourceMappingURL=ModuleAlias.js.map